[[custom-all]]
=== 自定义 _all 字段

在 <<all-field,all-field>> 字段中，我们解释过 `_all` 字段的索引方式是将所有其他字段的值作为一个大字符串索引的。((("_all field", sortas="all field")))((("multifield search", "custom _all fields")))尽管这么做并不十分灵活，但可以给人名添加一个自定义 `_all` 字段，再为地址添加另一个 `_all` 字段。

Elasticsearch 在字段映射中为我们提供了 `copy_to` 参数来实现这个功能：

[source,js]
--------------------------------------------------
PUT /my_index
{
    "mappings": {
        "person": {
            "properties": {
                "first_name": {
                    "type":     "string",
                    "copy_to":  "full_name" <1>
                },
                "last_name": {
                    "type":     "string",
                    "copy_to":  "full_name" <1>
                },
                "full_name": {
                    "type":     "string"
                }
            }
        }
    }
}
--------------------------------------------------
// SENSE: 110_Multi_Field_Search/45_Custom_all.json

<1> `first_name` 和 `last_name` 字段中的值会被复制到 `full_name` 字段。

有了这个映射，我们可以用 `first_name` 来查询名，用 `last_name` 来查询姓，或者直接使用 `full_name` 查询整个姓名。

NOTE: 映射中 `first_name` 和 `last_name` 并不知道 `full_name` 是如何索引的， `full_name` 将两个字段的内容复制到本地，然后根据 `full_name` 的映射自行索引。
